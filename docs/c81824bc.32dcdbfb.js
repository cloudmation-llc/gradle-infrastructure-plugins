(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{110:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return l})),a.d(t,"rightToc",(function(){return c})),a.d(t,"default",(function(){return b}));var n=a(2),r=a(6),o=(a(0),a(115)),i={id:"global-config",title:"Global Configuration",sidebar_label:"Global Configuration"},l={id:"aws/global-config",title:"Global Configuration",description:"The Gradle root project and its subprojects can be organized into a hierarchy, and the AWS plugins take full advantage of this to provide a layered configuration system.",source:"@site/docs/aws/configuration.md",permalink:"/gradle-infrastructure-plugins/aws/global-config",sidebar_label:"Global Configuration",sidebar:"mainSidebar",previous:{title:"About",permalink:"/gradle-infrastructure-plugins/about"},next:{title:"Getting Started",permalink:"/gradle-infrastructure-plugins/aws/cloudformation/cf-getting-started"}},c=[{value:"The AWS Config Block",id:"the-aws-config-block",children:[{value:"Authentication",id:"authentication",children:[]},{value:"Using MFA",id:"using-mfa",children:[]},{value:"Setting Resource Tags",id:"setting-resource-tags",children:[]},{value:"Tag Merging",id:"tag-merging",children:[]}]},{value:"Customize Task Generation",id:"customize-task-generation",children:[{value:"Task Naming",id:"task-naming",children:[]},{value:"Task Grouping",id:"task-grouping",children:[]},{value:"Including and Excluding Tasks",id:"including-and-excluding-tasks",children:[]}]}],s={rightToc:c};function b(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},s,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"The Gradle root project and its subprojects can be organized into a hierarchy, and the AWS plugins take full advantage of this to provide a layered configuration system."),Object(o.b)("p",null,"Configuration starts at the root project as demonstrated in the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"cf-tutorial"}),"tutorial"),". You can create an ",Object(o.b)("inlineCode",{parentName:"p"},"aws")," block to set a default region and credential profile. AWS subprojects will inherit this configuration, and you can selectively override config properties per subproject, and even per task."),Object(o.b)("p",null,"Unless otherwise specified, properties use the ",Object(o.b)("inlineCode",{parentName:"p"},"name = value")," syntax as shown in the examples below."),Object(o.b)("h2",{id:"the-aws-config-block"},"The AWS Config Block"),Object(o.b)("p",null,"The ",Object(o.b)("inlineCode",{parentName:"p"},"aws")," block provides settings that apply to any service used by the plugins."),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-groovy"}),'aws {\n    profile = "..." // Set a specific credential profile\n    region = "..." // Set a specific region\n}\n')),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Reference:")),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Property"),Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Default Value"),Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:null}),"Description"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"profile")),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"System default"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Set the credentials profile to use for AWS API calls")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"region")),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"System default"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Set the region to use for AWS API calls")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),Object(o.b)("inlineCode",{parentName:"td"},"tags")),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"None"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:null}),"Map of resource tags to be applied on resources which support them")))),Object(o.b)("h3",{id:"authentication"},"Authentication"),Object(o.b)("p",null,"Under the hood, the AWS Java SDK v2 is used to make service calls. If you do nothing, then the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://sdk.amazonaws.com/java/api/latest/software/amazon/awssdk/auth/credentials/DefaultCredentialsProvider.html"}),"default credential provider")," is used. This is typically the most ideal fit especially if you use the plugins in a CI/CD workflow."),Object(o.b)("p",null,"Optionally, you can configure authentication using a named profile on your system. Named profiles for AWS are set up by default in ",Object(o.b)("inlineCode",{parentName:"p"},"$HOME/.aws/config"),"."),Object(o.b)("p",null,"Learn more about ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html"}),"named profiles")," in the AWS documentation."),Object(o.b)("h3",{id:"using-mfa"},"Using MFA"),Object(o.b)("p",null,"MFA challenges are supported if the named profile you select has the ",Object(o.b)("inlineCode",{parentName:"p"},"mfa_serial")," and ",Object(o.b)("inlineCode",{parentName:"p"},"role_arn")," properties configured."),Object(o.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"Only devices that generate a six-digit code that can be consumed by the AWS SDK are supported. Read more about ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_mfa.html"}),"MFA setup")," in the AWS documentation."))),Object(o.b)("p",null,"The plugin will prompt you for the token code, and assume the role directly through the STS service. The session credentials are written to a temporary file on disk and used for subsequent task runs until they expire."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Example of a named profile configured for MFA:")),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-ini"}),"[profile sample_named_profile]\nduration_seconds = 7200\nrole_arn = arn:aws:iam::****:role/iam-role-to-assume\nrole_session_name = ****\nmfa_serial = arn:aws:iam::****:mfa/your-mfa-device\nsource_profile = default\nregion = us-west-2\noutput = json\n")),Object(o.b)("h3",{id:"setting-resource-tags"},"Setting Resource Tags"),Object(o.b)("p",null,"The AWS block supports providing resource tags. Call the ",Object(o.b)("inlineCode",{parentName:"p"},"tag")," method for each key-value pair, and provide as many pairs as you want within the limits supported by the specific resource you are working with."),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-groovy"}),'aws {\n    tag "tag-key", "tag-value"\n    tag "another-key", "another-value"\n}\n')),Object(o.b)("h3",{id:"tag-merging"},"Tag Merging"),Object(o.b)("p",null,"Most properties are overridden at the deepest point where they are assigned. Tags are one of the exceptions where the final tags assigned to a resource are the result of merging together all of the tags found in the project hierarchy."),Object(o.b)("p",null,"You might look at it this way: root tags + subproject(s) tags + task tags = tags applied to the resource."),Object(o.b)("p",null,"Overwrites will only happen if a tag deeper in the hierarchy has the same key name as a tag found earlier. For example, if you define a tag named ",Object(o.b)("inlineCode",{parentName:"p"},"department")," in a subproject, but the task also defines a ",Object(o.b)("inlineCode",{parentName:"p"},"department")," tag, the value assigned to the task will win."),Object(o.b)("p",null,"If no tags are found, then any existing custom tags are removed from the resources on the next deployment."),Object(o.b)("h2",{id:"customize-task-generation"},"Customize Task Generation"),Object(o.b)("p",null,"If you want to customize the tasks that are automatically generated by the plugin, add a ",Object(o.b)("inlineCode",{parentName:"p"},"taskGeneration")," config block to the ",Object(o.b)("inlineCode",{parentName:"p"},"aws")," block. ",Object(o.b)("strong",{parentName:"p"},"This is only supported at the subproject level.")),Object(o.b)("h3",{id:"task-naming"},"Task Naming"),Object(o.b)("p",null,"The plugin follow the Gradle convention of using camel casing for task names. The characters ",Object(o.b)("inlineCode",{parentName:"p"},"-")," ",Object(o.b)("inlineCode",{parentName:"p"},".")," ",Object(o.b)("inlineCode",{parentName:"p"},"_")," and ",Object(o.b)("inlineCode",{parentName:"p"}," ")," (space) are declared as delimiters which are fed into the camel case routine. Dashes (",Object(o.b)("inlineCode",{parentName:"p"},"-"),") are very readable and encouraged for naming files and custom stacks."),Object(o.b)("h3",{id:"task-grouping"},"Task Grouping"),Object(o.b)("p",null,"Gradle tasks support a ",Object(o.b)("inlineCode",{parentName:"p"},"group")," property to logically group tasks together under categories. Using grouping provides for a neater appearance in tools that display lists of tasks such as when you run ",Object(o.b)("inlineCode",{parentName:"p"},"gradle tasks")," on the command line. This is recommended."),Object(o.b)("p",null,"By default, the group will be set to ",Object(o.b)("inlineCode",{parentName:"p"},"aws"),", but you can change this to anything. For example you might consider grouping IAM tasks and network tasks separately."),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-groovy"}),'aws {\n    taskGeneration {\n        group = "Some other group"    \n    }\n}\n')),Object(o.b)("h3",{id:"including-and-excluding-tasks"},"Including and Excluding Tasks"),Object(o.b)("p",null,"There could be use cases when you want to alter which tasks are generated by the plugin. For example, you want to use use the custom stacks feature ",Object(o.b)("em",{parentName:"p"},"(see below)")," with a specific template file, and not have tasks generated automatically for that template. You can create rules that either use a ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html"}),"regular expression match")," on the task name, or you can provide a closure to use your own logic."),Object(o.b)("p",null,"Include rules are evaluated first, and then exclude rules are evaluated after. You can call ",Object(o.b)("inlineCode",{parentName:"p"},"include")," or ",Object(o.b)("inlineCode",{parentName:"p"},"exclude")," as many times as you want. Rules are evaluated in creation order."),Object(o.b)("h4",{id:"exclude-by-pattern"},"Exclude by Pattern"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-groovy"}),'aws {\n    taskGeneration {\n        exclude ".*VpcSubnet.*"   \n    }\n}\n')),Object(o.b)("h4",{id:"exclude-by-closure"},"Exclude by Closure"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-groovy"}),'aws {\n    taskGeneration {\n        exclude { taskName -> taskName == "someTaskYouWantToAvoid" }\n    }\n}\n')),Object(o.b)("h4",{id:"include-by-pattern"},"Include by Pattern"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-groovy"}),'aws {\n    taskGeneration {\n        include "lint.*"   \n    }\n}\n')),Object(o.b)("h4",{id:"include-by-closure"},"Include by Closure"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-groovy"}),'aws {\n    taskGeneration {\n        include { taskName -> taskName == "someTaskYouWantToEnsureIsCreated" }\n    }\n}\n')))}b.isMDXComponent=!0},115:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return m}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=r.a.createContext({}),b=function(e){var t=r.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},u=function(e){var t=b(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=b(a),d=n,m=u["".concat(i,".").concat(d)]||u[d]||p[d]||o;return a?r.a.createElement(m,l(l({ref:t},s),{},{components:a})):r.a.createElement(m,l({ref:t},s))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,i=new Array(o);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);